<!DOCTYPE HTML>
<html lang="en">
  <% include ../partials/Header %>
  <body>
    <div id="container" class="ui-notify"></div>
    <div class="wrapper">
      <!-- side-navigation -->
      <% include ../partials/side-navigation %>

      <!-- Header End -->

      <section class="main-section">
  
        <div class="container">
          <div class="row">
               <!-- top-stats -->
               <% include ../partials/top-stats %>
           
            <!-- main-bg-->
          </div>
          <!-- Row -->
        </div>
        <!-- Container -->
        <div class="container">
          <div class="col-md-12">
              <div
                aria-hidden="true"
                role="dialog"
                tabindex="-1"
                class="modal fade"
                id="myModalAddAccount"
                style="display: none;"
              >
                <div class="modal-dialog">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button
                          aria-hidden="true"
                          data-dismiss="modal"
                          class="close"
                          type="button"
                        >
                          ×
                        </button>
                        <h4 class="modal-title">Thêm tài khoản</h4>
                      </div>
                      <div class="modal-body">
                        <div class="col-md-12">
                          <form id="accountFormAdd"  enctype="multipart/form-data" method="POST" action="non-Ajax form handler" onsubmit="return checkForm(this)">
									<div class="form-group" style="width: 500px">
                    <div class="row">
                      <label class="form-label">Tên đầy đủ</label>
                  <input
                  
									  type="text"
									  name="fullname"
									  class="form-control"
									  placeholder="Tên đầy đủ"
									/>
                    </div>
              </div>
              
							<div class="form-group">
                <div class="row">
								<label class="form-label">Tên tài khoản</label>
								<input
								  type="text"
								  name="username"
								  class="form-control"
								  placeholder="Tên tài khoản"
                />
                </div>
                </div>
                
							  <div class="form-group">
                  <div class="row">
                    <label class="form-label">Mật khẩu</label>
                    <input
                      type="password"
                      name="password"
                      class="form-control"
                      placeholder="Mật khẩu"
                    />
                  </div>
                </div>
                
							  <div class="form-group">
                  <div class="row">
                    <label class="form-label">Email</label>
                    <input
                    pattern="/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/"
                      name="email"
                      class="form-control"
                      placeholder="Địa chỉ email"
                    />
                  </div>
                </div>
                <!-- <div class="form-group">
                  <div class="row">
                    <input
                    pattern="/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/"
                      name="email"
                      class="form-control"
                      placeholder="Địa chỉ email"
                    />
                  </div> -->
							  </div>
                          </form>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          data-dismiss="modal"
                          class="btn gray"
                          type="button"
                        >
                          Close
                        </button>
                        <button
                          class="btn blue"
                          id="btnSubmit"
                          onclick="addAccount(event)"
                          name="btnCreate"
                          type="button"
                        >
                          Thêm Tài khoản
                        </button>
                      </div>
                    </div>
                    <!-- /.modal-content -->
                  </div>
                </div>
                <!-- /.modal-content -->
              </div>
              <div class="form-group">
                <div class="row">
                  <div class="col-md-6">
              <a
                class="btns blue sml-btn"
                href="#myModalAddAccount"
				data-toggle="modal"
                >Thêm Tài khoản</a
              >
                  </div>
                </div>
              </div>
              <!-- Modal Open Button -->
		  </div>
		  <!-- Modal edit -->
		  <div class="col-md-12">
              <div
                aria-hidden="true"
                role="dialog"
                tabindex="-1"
                class="modal fade"
                id="myModalEditAccount"
                style="display: none;"
              >
                <div class="modal-dialog">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button
                          aria-hidden="true"
                          data-dismiss="modal"
                          class="close"
                          type="button"
                        >
                          ×
                        </button>
                        <h4 class="modal-title">Chỉnh sửa tài khoản</h4>
                      </div>
                      <div class="modal-body">
                        <div class="col-md-12">
                         <form id="accountForm" enctype="multipart/form-data">
                            <div class="form-group">
								<input type="hidden" name="accountIdEdit">
                              <label class="form-label">Tên đầy đủ</label>
                              <input
                                type="text"
                                name="fullnameEdit"
                                class="form-control"
                                placeholder="Tên đầy đủ"
                              />
							</div>
							<div class="form-group">
								<label class="form-label">Tên tài khoản</label>
								<input
                  type="text"
                  disabled="true"
								  name="usernameEdit"
								  class="form-control"
								  placeholder="Tên tài khoản"
								/>
							  </div>
							  <div class="form-group" hidden>
								<label class="form-label">Mật khẩu</label>
								<input
								  type="password"
								  name="passwordEdit"
								  class="form-control"
								  placeholder="Mật khẩu"
								/>
							  </div>
							  <div class="form-group">
								<label class="form-label">Email</label>
								<input
								  type="email"
								  name="emailEdit"
								  class="form-control"
								  placeholder="Địa chỉ email"
								/>
							  </div>
                          </form>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          data-dismiss="modal"
                          class="btn gray"
                          type="button"
                        >
                          Close
                        </button>
                        <button type="button" id="btnSubmit" onclick="editAccount(event)" name="btnCreate"
												class="btn blue">Cập nhật</button>
                      </div>
                    </div>
                    <!-- /.modal-content -->
                  </div>
                </div>
                <!-- /.modal-content -->
              </div>
            
		  </div>
		  <div class="col-md-12">
              <div
                aria-hidden="true"
                role="dialog"
                tabindex="-1"
                class="modal fade"
                id="myModalDeleteAccount"
                style="display: none;"
              >
                <div class="modal-dialog">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button
                          aria-hidden="true"
                          data-dismiss="modal"
                          class="close"
                          type="button"
                        >
                          ×
                        </button>
                        <h4 class="modal-title">Xóa tài khoản</h4>
                      </div>
                      <div class="modal-body">
                        <div class="col-md-12">
                          <form id="deleteProTypeForm" enctype="multipart/form-data">
                            <p name="accountIdDel" hidden>
							</p>
							<p> Bạn muốn xóa tài khoản này này?
							</p>
							<p name="usernameDel">
							</p>
                          </form>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          data-dismiss="modal"
                          class="btn gray"
                          type="button"
                        >
                          Close
                        </button>
                        <button type="button" id="btnSubmit" onclick="deleteAccount(event)" 
												class="btn blue">Xóa</button>
                      </div>
                    </div>
                    <!-- /.modal-content -->
                  </div>
                </div>
                <!-- /.modal-content -->
              </div>
            
          </div>
          <div class="col-md-12">
            <div class="widget-body">
              <div class="widget-heading purple">
                <i class="icon-table pull-left"></i>
                <h3 class="pull-left">Danh sách tài khoản</h3>
              </div>
              <div class="widget-sec">
                <div class="streaming-table">
                
                  </div>
                  <table
                    id="stream_table"
                    class="table table-striped table-bordered"
                  >
                    <thead>
                      <tr>
                        <th hidden></th>
                        <th style="width: 25%;">Tên đầy đủ</th>
                        <th>Tên người dùng</th>
                        <th hidden></th>
                        <th style="width: 20%;">Địa chỉ email</th>
                        <th style="width: 20%;">Tuỳ chỉnh</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% for (var i = 0; i < listAccount.length; i++) { %>
                      <tr>
                        <td hidden><%= listAccount[i]._id %></td>
                        <td><%= listAccount[i].fullName %></td>
                        <td><%= listAccount[i].username %></td>
                        <td hidden><%= listAccount[i].password %></td>
                        <td>
							<%= listAccount[i].email %>
                        </td>
                        <td>
                          <button
                            class="btns blue m-sml-btn"
                            type="button"
                            name="btn_edit"
                            data-toggle="modal"
							data-target="#myModalEditAccount"
                          >
							<i class="icon-pencil" data-feather="edit-2"></i>
							Edit
                          </button>
						  <button
						  class="btns  red  m-sml-btn "
                            type="button"
                            name="btn_delete"
                            data-toggle="modal"
                            data-target="#myModalDeleteAccount"
                          >
							<i class="icon-remove" data-feather="trash"></i>
							Remove
                          </button>
                        </td>
                      </tr>
                      <% } %>
                    </tbody>
                  </table>
                  <div id="summary">
                    <div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Main Section -->
    </div>
    <!-- Wrapper -->

    <!-- Body -->

    <script type="text/javascript">
      var addAccount = function (event) {
        event.preventDefault();
        var formData = new FormData();

        var username = $("[name=username]").val();
	    	var fullname = $("[name=fullname]").val();
        var email = $("[name=email]").val();
        var password = $("[name=password]").val();
        const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  if(!re.test(email)){
    alert("Email không hợp lệ")
    location.reload();

  }

        formData.append("username", username);
        formData.append("fullname", fullname);
        formData.append("email", email);
        formData.append("password", password);

        $.ajax({
          url: "account/addAccount",
          type: "POST",
          data: formData,
          cache: false,
          contentType: false,
          processData: false,
        })
          .done(function (result) {
            if (result.success) {
            //   alert(result.mgs);
              location.reload();
            } else {
              alert(result.mgs);
            }
          })
          .fail(() => {
            alert("Không kết nối được với server");
          });
      };

      var editAccount = function (event) {
        event.preventDefault();
        var formData = new FormData();
        var fullname = $("[name=fullnameEdit]").val();
        var username = $("[name=usernameEdit]").val();
        var password = $("[name=passwordEdit]").val();
        var email = $("[name=emailEdit]").val();

        formData.append("fullname", fullname);
        formData.append("username", username);
        formData.append("password", password);
        formData.append("email", email);

        $.ajax({
          url: "account/editAccount",
          type: "POST",
          data: formData,
          cache: false,
          contentType: false,
          processData: false,
        })
          .done(function (result) {
            if (result.success) {
            //   alert(result.mgs);
              location.reload();
            } else {
              alert(result.mgs);
            }
          })
          .fail(() => {
            alert("Không kết nối được với server");
          });
      };
      var deleteAccount = function (event) {
        event.preventDefault();

        var formData = new FormData();
        var accountId = $("[name=accountIdDel]").text();

        formData.append("accountId", accountId);

        $.ajax({
          url: "account/deleteAccount",
          type: "POST",
          data: formData,
          cache: false,
          contentType: false,
          processData: false,
        })
          .done(function (result) {
            if (result.success) {
              alert(result.mgs);
              location.reload();
            } else {
              alert(result.mgs);
            }
          })
          .fail(() => {
            alert("Không kết nối được với server");
          });
      };
      
      $("[name=btn_edit]").click(function () {
        var accountId = $(this).parent().parent().children().eq(0).html();
        var fullname = $(this).parent().parent().children().eq(1).html();
        var username = $(this).parent().parent().children().eq(2).html();
        var password= $(this).parent().parent().children().eq(3).html();
        var email= $(this).parent().parent().children().eq(4).html();

        $("[name=fullnameEdit]").val(fullname);
        $("[name=usernameEdit]").val(username);
        $("[name=passwordEdit]").val(password);
        $("[name=emailEdit]").val(email);
      });
      $("[name=btn_delete]").click(function () {
        var accountId = $(this).parent().parent().children().eq(0).html();
        var username = $(this).parent().parent().children().eq(1).html();
        $("[name=accountIdDel]").text(accountId);
        $("[name=usernameDel]").text(username);
      });
    </script>
    
    <script src="js/app.js"></script>
  </body>
</html>
